

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; ECGkit 1.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ECGkit 1.0.1 documentation" href="index.html"/>
        <link rel="next" title="ECGwrapper" href="ECGwrapper.html"/>
        <link rel="prev" title="Examples" href=""/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> ECGkit</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release notes</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Be in touch</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">A simple example</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Another example</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ECGwrapper.html">Accessing signals</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ECGtask.html">Performing tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="QRS_detection.html">QRS detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="QRScorrector.html">QRS correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="ABP_PPG_peak_detection.html">ABP/PPG peak detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="ABP_PPG_peak_correction.html">ABP/PPG peak correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="ECGdelineation.html">ECG delineation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ECG_delineation_corrector.html">ECG delineation correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="ECG_heartbeat_classifier.html">Heartbeat classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="Arbitrary_tasks.html">Arbitrary tasks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reportECG.html">Plotting and reporting</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="custom_formats.html">Extensions</a><ul class="simple">
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ECGkit</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Examples</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/examples.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="example-of-how-to-use-the-ecgkit">
<h2>Example of how to use the ECGkit<a class="headerlink" href="#example-of-how-to-use-the-ecgkit" title="Permalink to this headline">¶</a></h2>
<p>This script exemplifies the use of the ECGkit in a multimodal
cardiovascular recording which includes arterial blood pressure (ABP),
plethysmographic (PPG) and electrocardiogram signals. The following
tasks will be performed in this example:</p>
<ul class="simple">
<li>Heartbeat/QRS detection</li>
<li>ABP/PPG pulse detection</li>
<li>ECG wave delineation</li>
<li>Heartbeat classification</li>
<li>Report generation</li>
</ul>
<p>Each automatic step is followed by a manual verification step in order
to verify the algorithm&#8217;s results. The script is prepared to run locally
without arguments, as well as in a cluster environment by using
&#8220;pid_str&#8221; argument. The pid_str argument is a char with format &#8216;N/M&#8217;,
being N &lt;= M with default value &#8216;1/1&#8217;. You can partition a big job into
M pieces in cluster architecture, by starting M processes with N ranging
from 1 to M.</p>
<p>You can watch a typical run of this script for small, local ECG
recording on
<a class="reference external" href="https://www.youtube.com/watch?v=8lJtkGhrqFw&amp;list=PLlD2eDv5CIe9sA2atmnb-DX48FIRG46z7">YouTube</a>.</p>
<p>Example of how to run this script</p>
<div class="code highlight-Matlab"><div class="highlight"><pre><span class="n">examples</span><span class="p">()</span>
<span class="n">examples</span><span class="p">(</span><span class="s">&#39;1/1&#39;</span><span class="p">,</span> <span class="s">&#39;C:\Your_preferred_local_path\&#39;</span><span class="p">,</span> <span class="s">&#39;arbitrary_string&#39;</span><span class="p">)</span>
<span class="n">examples</span><span class="p">(</span><span class="s">&#39;1/10&#39;</span><span class="p">,</span> <span class="s">&#39;/Your_preferred_path_in_cluster/&#39;</span><span class="p">,</span> <span class="s">&#39;arbitrary_string&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="#function-prototype"><span>Function prototype</span></a></li>
<li><a class="reference internal" href="#argument-parsing"><span>Argument parsing</span></a></li>
<li><a class="reference internal" href="#qrs-automatic-detection"><span>QRS automatic detection</span></a></li>
<li><a class="reference internal" href="#qrs-visual-inspection-and-correction"><span>QRS visual inspection and
correction</span></a></li>
<li><a class="reference internal" href="#ppg-abp-pulse-detection"><span>PPG/ABP pulse detection</span></a></li>
<li><a class="reference internal" href="#ppg-abp-waves-visual-inspection-and-correction"><span>PPG/ABP waves visual inspection and
correction</span></a></li>
<li><a class="reference internal" href="#ecg-automatic-delineation"><span>ECG automatic delineation</span></a></li>
<li><a class="reference internal" href="#visual-inspection-of-the-detection-delineation"><span>Visual inspection of the
detection/delineation</span></a></li>
<li><a class="reference internal" href="#automatic-heartbeat-classification"><span>Automatic Heartbeat
classification</span></a></li>
<li><span class="xref std std-ref">Visual inspection of the
signal</span></li>
<li><a class="reference internal" href="#other-user-defined-tasks"><span>Other user-defined tasks ...</span></a></li>
</ul>
</div>
<div class="section" id="function-prototype">
<span id="id1"></span><h2>Function prototype<a class="headerlink" href="#function-prototype" title="Permalink to this headline">¶</a></h2>
<div class="code highlight-Matlab"><div class="highlight"><pre><span class="k">function</span><span class="w"> </span><span class="nf">examples</span><span class="p">(</span>pid_str, examples_path, user_str<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p><em>examples</em> accepts three <em>optional</em> arguments:</p>
<ul class="simple">
<li><strong>pid_str</strong> (optional) string identifier for this work instance in
a cluster computing or multitask environment. The identifier follows
the form &#8216;N/M&#8217;, being N a number which identifies this execution
instance and M the total amount of instances. <code class="docutils literal"><span class="pre">'1/1'</span> <span class="pre">(default)</span></code></li>
<li><strong>examples_path</strong> (optional) string of the path with ECG
recordings. <code class="docutils literal"><span class="pre">['.'</span> <span class="pre">filesep</span> <span class="pre">'example_recordings'</span> <span class="pre">filesep</span> <span class="pre">]</span> <span class="pre">(default)</span></code>;</li>
<li><strong>user_str</strong> (optional) string to identify this run or experiment.</li>
</ul>
</div>
<div class="section" id="argument-parsing">
<span id="id2"></span><h2>Argument parsing<a class="headerlink" href="#argument-parsing" title="Permalink to this headline">¶</a></h2>
<p>Simple and straight forward.</p>
<div class="code highlight-Matlab"><div class="highlight"><pre>    <span class="k">if</span><span class="p">(</span> <span class="n">nargin</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="o">~</span><span class="n">ischar</span><span class="p">(</span><span class="n">pid_str</span><span class="p">)</span> <span class="p">)</span>
        <span class="c">% single PID run</span>
        <span class="n">pid_str</span> <span class="p">=</span> <span class="s">&#39;1/1&#39;</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">nargin</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">||</span> <span class="o">~</span><span class="n">exist</span><span class="p">(</span><span class="n">examples_path</span><span class="p">,</span> <span class="s">&#39;dir&#39;</span><span class="p">)</span> <span class="p">)</span>
        <span class="c">% inspect ECG files in rootpath\example_recordings\ folder</span>
        <span class="n">root_path</span> <span class="p">=</span> <span class="n">fileparts</span><span class="p">(</span><span class="n">mfilename</span><span class="p">(</span><span class="s">&#39;fullpath&#39;</span><span class="p">));</span>
        <span class="c">% default folder to look at</span>
        <span class="n">examples_path</span> <span class="p">=</span> <span class="p">[</span><span class="n">root_path</span> <span class="n">filesep</span> <span class="s">&#39;example_recordings&#39;</span> <span class="n">filesep</span> <span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">~</span><span class="n">exist</span><span class="p">(</span><span class="n">examples_path</span><span class="p">,</span> <span class="s">&#39;dir&#39;</span><span class="p">))</span>
            <span class="n">disp_string_framed</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;Please provide a valid path with ECG recordings&#39;</span><span class="p">);</span>
            <span class="k">return</span>
        <span class="k">end</span>
    <span class="k">else</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">examples_path</span><span class="p">(</span><span class="k">end</span><span class="p">)</span> <span class="o">~=</span> <span class="n">filesep</span> <span class="p">)</span>
            <span class="n">examples_path</span> <span class="p">=</span> <span class="p">[</span><span class="n">examples_path</span> <span class="n">filesep</span><span class="p">];</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">nargin</span> <span class="o">&lt;</span> <span class="mi">3</span>  <span class="p">)</span>
        <span class="n">user_str</span> <span class="p">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="k">end</span>
<span class="c">% Explore the *examples_path* for ECG recordings.</span>
    <span class="n">filenames</span> <span class="p">=</span> <span class="n">dir</span><span class="p">(</span><span class="n">examples_path</span><span class="p">);</span>
    <span class="n">recnames</span> <span class="p">=</span> <span class="p">{</span><span class="n">filenames</span><span class="p">(:).</span><span class="n">name</span><span class="p">};</span>
<span class="c">% In this case I hardcoded only one recording</span>
    <span class="n">recnames</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;ex_ABP_PPG_Registro_01M&#39;</span><span class="p">};</span>
<span class="c">% But you can use this to iterate for all of them.</span>
<span class="c">%     [~,recnames] = cellfun(@(a)(fileparts(a)), recnames, &#39;UniformOutput&#39;, false);</span>
<span class="c">%     recnames = unique(recnames);</span>
<span class="c">%     recnames = setdiff(recnames, {&#39;&#39; &#39;.&#39; &#39;..&#39; &#39;results&#39; &#39;condor&#39; });</span>
<span class="c">%     recnames = recnames(1)</span>
    <span class="n">lrecnames</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">recnames</span><span class="p">);</span>
    <span class="c">% In case of running in a user-assisted fashion.</span>
    <span class="n">bUseDesktop</span> <span class="p">=</span> <span class="n">usejava</span><span class="p">(</span><span class="s">&#39;desktop&#39;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">bUseDesktop</span> <span class="p">)</span>
        <span class="n">tmp_path</span> <span class="p">=</span> <span class="n">tempdir</span><span class="p">;</span>
        <span class="n">output_path</span> <span class="p">=</span> <span class="p">[</span> <span class="n">examples_path</span> <span class="s">&#39;results&#39;</span> <span class="n">filesep</span> <span class="p">];</span>
    <span class="k">else</span>
        <span class="c">% For cluster or distributed environment processing.</span>
        <span class="n">InstallECGkit</span><span class="p">();</span>
        <span class="c">% this is a local path, usually faster to reach than output_path</span>
        <span class="n">tmp_path</span> <span class="p">=</span> <span class="s">&#39;/scratch/&#39;</span><span class="p">;</span>
        <span class="c">% distributed or cluster-wide accesible path</span>
        <span class="n">output_path</span> <span class="p">=</span> <span class="p">[</span> <span class="n">examples_path</span> <span class="s">&#39;results&#39;</span> <span class="n">filesep</span> <span class="p">];</span>
    <span class="k">end</span>
<span class="c">% just for debugging, keep it commented.</span>
<span class="c">%     bUseDesktop = false</span>
</pre></div>
</div>
</div>
<div class="section" id="qrs-automatic-detection">
<span id="id3"></span><h2>QRS automatic detection<a class="headerlink" href="#qrs-automatic-detection" title="Permalink to this headline">¶</a></h2>
<p>In this example the first step is the location of each heartbeat, or QRS
complexes detection. To achieve this, the kit includes the following
algorithms:</p>
<ul class="simple">
<li>Wavedet</li>
<li>Pan &amp; Tompkins</li>
<li>gqrs</li>
<li>sqrs</li>
<li>wqrs</li>
<li>ecgpuwave</li>
</ul>
<p>The way of performing QRS detection (or almost any other task in this
ECGkit) is through an
<a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGwrapper')">ECGwrapper</a>
object. The objective of this object is to abstract or sepparate any
algorithm from the particular details of the ECG signal. This object is
able to invoque any kind of algorithm through the interface provided of
other object, called
<a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGwrapper')">ECGtask</a>
obejcts.</p>
<p>The <em>ECGtask</em> obejcts actually perform specific task on the ECG signal,
in this case, the QRS complex detection. Each task have general
properties such as <em>user_string</em>, <em>progress_handle</em> (see
<a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:edit('ECGtask.m')">ECGtask</a>
class for more details) and other specific for a certain task, such as
<em>detectors</em>, <em>only_ECG_leads</em>, <em>wavedet_config</em>,
<em>gqrs_config_filename</em> (see others in <a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:edit('ECGtask_QRS_detection.m')">QRS
detection</a>
task source).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;% go through all files
&nbsp;&nbsp;&nbsp;&nbsp;ECG_all_wrappers = [];
&nbsp;&nbsp;&nbsp;&nbsp;jj = 1;
&nbsp;&nbsp;&nbsp;&nbsp;for ii = 1:lrecnames
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rec_filename = [examples_path recnames{ii}];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;% task name,
% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd = &#8216;QRS_detection&#8217;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;% or create an specific handle to have more control
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd = ECGtask_QRS_detection();
% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;% select an specific algorithm. Default: Run all detectors
% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd.detectors = &#8216;wavedet&#8217;; % Wavedet algorithm based on
% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd.detectors = &#8216;pantom&#8217;; &nbsp;% Pan-Tompkins alg.
% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd.detectors = &#8216;gqrs&#8217;; &nbsp;&nbsp;&nbsp;% WFDB gqrs algorithm.
%         % Example of how you can add your own QRS detector.
% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd.detectors = &#8216;user:example_worst_ever_QRS_detector&#8217;;
% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd.detectors = &#8216;user:your_QRS_detector_func_name&#8217;; &nbsp;&nbsp;&nbsp;%
% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#8220;your_QRS_detector_func_name&#8221; can be your own detector.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd.detectors = {&#8216;wavedet&#8217; &#8216;gqrs&#8217; &#8216;wqrs&#8217; &#8216;user:example_worst_ever_QRS_detector&#8217;};
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;% you can individualize each run of the QRS detector with an
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;% external string
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd.user_string = user_str;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;% or group by the config used
% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd.user_string = ECGt_QRSd.detectors;
% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd.only_ECG_leads = false; &nbsp;&nbsp;&nbsp;% consider all signals ECG
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECGt_QRSd.only_ECG_leads = true; &nbsp;&nbsp;&nbsp;% Identify ECG signals based on their header description.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECG_w = ECGwrapper( &#8216;recording_name&#8217;, rec_filename, ...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#8216;this_pid&#8217;, pid_str, ...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#8216;tmp_path&#8217;, tmp_path, ...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#8216;output_path&#8217;, output_path, ...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#8216;ECGtaskHandle&#8217;, ECGt_QRSd);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;% process the task
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECG_w.Run;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;% collect object if were recognized as ECG recordings.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( jj == 1)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECG_all_wrappers = ECG_w;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECG_all_wrappers(jj) = ECG_w;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jj = jj + 1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch MException
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( strfind(MException.identifier, &#8216;ECGwrapper:ArgCheck:InvalidFormat&#8217;) )
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disp_string_framed(&#8216;<a href="#id4"><span class="problematic" id="id5">*</span></a>Red&#8217;, sprintf( &#8216;Could not guess the format of %s&#8217;, ECG_w.recording_name) );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;% report just in case
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;report = getReport(MException);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(2, &#8216;n%sn&#8217;, report);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
&nbsp;&nbsp;&nbsp;&nbsp;end
&nbsp;&nbsp;&nbsp;&nbsp;% recognized recordings
&nbsp;&nbsp;&nbsp;&nbsp;lrecnames = length(ECG_all_wrappers);
&nbsp;&nbsp;&nbsp;&nbsp;% at the end, report problems if happened.
&nbsp;&nbsp;&nbsp;&nbsp;for ii = 1:lrecnames
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECG_all_wrappers(ii).ReportErrors;
&nbsp;&nbsp;&nbsp;&nbsp;end</p>
</div>
<div class="section" id="qrs-visual-inspection-and-correction">
<span id="id6"></span><h2>QRS visual inspection and correction<a class="headerlink" href="#qrs-visual-inspection-and-correction" title="Permalink to this headline">¶</a></h2>
<p>This part of the example uses a graphical user interface (GUI) to allow
the user correcting mistakes that the previous automatic algorithm
eventually makes.</p>
<p>As can be seen in the following code, the first step is checking that
the previous QRS detection task finished without problems. Then if no
errors, the corrector will use as starting point the result of this same
task, in case the user would like to edit a previously edited result, or
if not available the result of the QRS detection task.</p>
<div class="code highlight-Matlab"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span> <span class="n">bUseDesktop</span> <span class="p">)</span>
    <span class="c">% other task can be performed on the same objects</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="c">% last worker is the responsible of the visual correction.</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="o">==</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cant_pids</span><span class="p">)</span>
            <span class="c">% if there are not any previous error.</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Processed</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Error</span> <span class="p">)</span>
                <span class="c">% this is to use previous saved results as starting point,</span>
                <span class="c">% if any available</span>
                <span class="n">cached_filenames</span> <span class="p">=</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">GetCahchedFileName</span><span class="p">({</span><span class="s">&#39;QRS_corrector&#39;</span> <span class="s">&#39;QRS_detection&#39;</span><span class="p">});</span>
                <span class="c">% if no previous correction work, try the automatic</span>
                <span class="c">% detection task</span>
                <span class="c">% if any, do the correction</span>
                <span class="k">if</span><span class="p">(</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">cached_filenames</span><span class="p">)</span> <span class="p">)</span>
                    <span class="c">% this is to use previous saved results as starting point,</span>
                    <span class="c">% if any available</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span> <span class="p">=</span> <span class="s">&#39;QRS_corrector&#39;</span><span class="p">;</span>
                    <span class="c">% This task is supposed to be supervised, so only one pid is enough.</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="p">=</span> <span class="s">&#39;1/1&#39;</span><span class="p">;</span>
                    <span class="c">% user provided name to individualize each run</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">user_string</span> <span class="p">=</span> <span class="n">user_str</span><span class="p">;</span>
                    <span class="c">% to avoid loading cached results and exit, this flag</span>
                    <span class="c">% allows the re-editing of the current state of the</span>
                    <span class="c">% detections.</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cacheResults</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
                    <span class="c">% maybe in your application you should run this for</span>
                    <span class="c">% all files.</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">payload</span> <span class="p">=</span> <span class="n">load</span><span class="p">(</span><span class="n">cached_filenames</span><span class="p">{</span><span class="mi">1</span><span class="p">});</span>
                    <span class="c">% process the task</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Run</span><span class="p">;</span>
                    <span class="c">% restore the original pids configuration</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="p">=</span> <span class="n">pid_str</span><span class="p">;</span>
                    <span class="c">% As we changed for &quot;QRS correction&quot; task, we have to enable this</span>
                    <span class="c">% value again in order to avoid performing the following tasks every time.</span>
                    <span class="c">% If you want to recalculate any task, change it to false</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cacheResults</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
                <span class="k">end</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="c">% at the end, report problems if happened.</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ReportErrors</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Then the task invoked by the wrapper object is changed to <a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:edit('ECGtask_QRS_corrector.m')">QRS corrector
task</a>
and the GUI is presented to the user.</p>
<p><img alt="image4" src="_images/QRS_corrector.PNG" /></p>
<p>In this example, the GUI have four plots to represent the RR interval
series, the two in the top-left show the RR interval versus time at
different time windows. The bigger in the top-right, shows a <em>Poincaré</em>
plot, that is the current RR interval versus the following in the serie.
The plot in the bottom shows the selected signal/s versus time. Then the
user can interact with the plots according to the <a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGtask_QRS_corrector')">QRS corrector
documentation</a></p>
</div>
<div class="section" id="ppg-abp-pulse-detection">
<span id="id7"></span><h2>PPG/ABP pulse detection<a class="headerlink" href="#ppg-abp-pulse-detection" title="Permalink to this headline">¶</a></h2>
<p>In case the recording includes pulsatile signals, such as
plethysmographic (PPG) or arterial blood pressure (ABP), this kit
includes the <a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGtask_PPG_ABP_detector')">PPG/ABP automatic detector
task</a>
which allows the use of two algorithms to perform peak detection,
<a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('PPG_pulses_detector')">WavePPG</a>
and <a class="reference external" href="wabp-1.htm','-browser')">Physionet&#8217;s wabp</a>.</p>
<p>other task can be performed on the same objects</p>
<div class="code highlight-Matlab"><div class="highlight"><pre><span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
    <span class="c">% set the delineator task name and run again.</span>
    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span> <span class="p">=</span> <span class="s">&#39;PPG_ABP_detector&#39;</span><span class="p">;</span>
    <span class="c">% user provided name to individualize each run</span>
    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">user_string</span> <span class="p">=</span> <span class="n">user_str</span><span class="p">;</span>
    <span class="c">% process the task</span>
    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Run</span><span class="p">;</span>
<span class="k">end</span>
<span class="c">% at the end, report problems if happened.</span>
<span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ReportErrors</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="ppg-abp-waves-visual-inspection-and-correction">
<span id="id8"></span><h2>PPG/ABP waves visual inspection and correction<a class="headerlink" href="#ppg-abp-waves-visual-inspection-and-correction" title="Permalink to this headline">¶</a></h2>
<p>The same manual verification made for automatic QRS detection algorithms
can be performed with pulsatile signals. The <a class="reference external" href="../../../../../../jsD:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGtask_PPG_ABP_corrector')">PPG/ABP corrector
task</a>
was designed to allow users the verification and correction of automatic
detections through the same GUI.</p>
<p><img alt="image5" src="_images/PPG-ABP_corrector.PNG" /></p>
<p>The following code shows how to use this task. As you can note, the
interface is almost the same used for the QRS correction task.</p>
<div class="code highlight-Matlab"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span> <span class="n">bUseDesktop</span> <span class="p">)</span>
    <span class="c">% other task can be performed on the same objects</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="c">% last worker is the responsible of the visual correction.</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="o">==</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cant_pids</span><span class="p">)</span>
            <span class="c">% if there are not any previous error.</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Processed</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Error</span> <span class="p">)</span>
                <span class="c">% this is to use previous saved results as starting point,</span>
                <span class="c">% if any available</span>
                <span class="n">cached_filenames</span> <span class="p">=</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">GetCahchedFileName</span><span class="p">({</span><span class="s">&#39;PPG_ABP_corrector&#39;</span> <span class="s">&#39;PPG_ABP_detector&#39;</span><span class="p">});</span>
                <span class="c">% if no previous correction work, try the automatic</span>
                <span class="c">% detection task</span>
                <span class="c">% if any, do the correction</span>
                <span class="k">if</span><span class="p">(</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">cached_filenames</span><span class="p">)</span> <span class="p">)</span>
                    <span class="c">% this is to use previous saved results as starting point,</span>
                    <span class="c">% if any available</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span> <span class="p">=</span> <span class="s">&#39;PPG_ABP_corrector&#39;</span><span class="p">;</span>
                    <span class="c">% This task is supposed to be supervised, so only one pid is enough.</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="p">=</span> <span class="s">&#39;1/1&#39;</span><span class="p">;</span>
                    <span class="c">% user provided name to individualize each run</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">user_string</span> <span class="p">=</span> <span class="n">user_str</span><span class="p">;</span>
                    <span class="c">% to avoid loading cached results and exit, this flag</span>
                    <span class="c">% allows the re-editing of the current state of the</span>
                    <span class="c">% detections.</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cacheResults</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
                    <span class="c">% maybe in your application you should run this for</span>
                    <span class="c">% all files.</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">payload</span> <span class="p">=</span> <span class="n">load</span><span class="p">(</span><span class="n">cached_filenames</span><span class="p">{</span><span class="mi">1</span><span class="p">});</span>
                    <span class="c">% process the task</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Run</span><span class="p">;</span>
                    <span class="c">% restore the original pids configuration</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="p">=</span> <span class="n">pid_str</span><span class="p">;</span>
                    <span class="c">% As we changed for &quot;QRS correction&quot; task, we have to enable this</span>
                    <span class="c">% value again in order to avoid performing the following tasks every time.</span>
                    <span class="c">% If you want to recalculate any task, change it to false</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cacheResults</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
                <span class="k">end</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="c">% at the end, report problems if happened.</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ReportErrors</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="ecg-automatic-delineation">
<span id="id9"></span><h2>ECG automatic delineation<a class="headerlink" href="#ecg-automatic-delineation" title="Permalink to this headline">¶</a></h2>
<p>Once the QRS complexes were detected, each heartbeat can be segmented or
delineated into P-QRS-T waves. To achieve this the kit includes an <a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGtask_ECG_delineation')">ECG
delineation
task</a>
to interface with the
<a class="reference external" href="articleDetails.jsp?arnumber=1275572','-browser')">wavedet</a> and
others user-defined algorithms, as described in the <a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGtask_ECG_delineation')">task
help</a>.
The interface follows the same guidelines described before, as is shown
in the following code.</p>
<p>other task can be performed on the same objects</p>
<div class="code highlight-Matlab"><div class="highlight"><pre>    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="c">% this is to use previous cached results as starting point</span>
        <span class="n">cached_filenames</span> <span class="p">=</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">GetCahchedFileName</span><span class="p">(</span><span class="s">&#39;QRS_corrector&#39;</span><span class="p">);</span>
        <span class="c">% if corrected QRS detections are not available, wavedet</span>
        <span class="c">% performs automatic QRS detection.</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">cached_filenames</span><span class="p">)</span> <span class="p">)</span>
            <span class="c">% this is to use previous result from the automatic QRS</span>
            <span class="c">% detection</span>
            <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">payload</span> <span class="p">=</span> <span class="n">load</span><span class="p">(</span><span class="n">cached_filenames</span><span class="p">{</span><span class="mi">1</span><span class="p">});</span>
        <span class="k">end</span>
        <span class="c">% set the delineator task name and run again.</span>
        <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span> <span class="p">=</span> <span class="s">&#39;ECG_delineation&#39;</span><span class="p">;</span>
        <span class="c">% user provided name to individualize each run</span>
        <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">user_string</span> <span class="p">=</span> <span class="n">user_str</span><span class="p">;</span>
        <span class="c">% Identify ECG signals based on their header description and</span>
        <span class="c">% perform delineation in those leads.</span>
        <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">only_ECG_leads</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
<span class="c">%         ECGt_QRSd.detectors = &#39;wavedet&#39;; % Wavedet algorithm based on</span>
<span class="c">%         ECGt_QRSd.detectors = &#39;user:example_worst_ever_ECG_delineator&#39;;</span>
<span class="c">%         % Example of how you can add your own ECG delineator.</span>
<span class="c">%         ECGt_QRSd.detectors = &#39;user:your_ECG_delineator_func_name&#39;;</span>
<span class="c">%         &quot;your_ECG_delineator_func_name&quot; can be your own delineator.</span>
        <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">delineators</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;wavedet&#39;</span> <span class="s">&#39;user:example_worst_ever_ECG_delineator&#39;</span><span class="p">};</span>
        <span class="c">% process the task</span>
        <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Run</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="c">% at the end, report problems if happened.</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ReportErrors</span><span class="p">;</span>
    <span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="visual-inspection-of-the-detection-delineation">
<span id="id10"></span><h2>Visual inspection of the detection/delineation<a class="headerlink" href="#visual-inspection-of-the-detection-delineation" title="Permalink to this headline">¶</a></h2>
<p>The same manual verification made for all the previous automatic tasks
is repeated for ECG delineation. The <a class="reference external" href="../../../../../../jsD:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGtask_ECG_delineation_corrector')">ECG delineation corrector
task</a>
was designed to allow users the verification and correction of automatic
delineation through the same GUI. The only difference with respect to
the behaviour of the QRS or PPG/ABP correction GUI, is that addition of
new events to the P-QRS-T series is not allowed, in order to keep the
assosiation of a wave fiducial point to a heartbeat.</p>
<p><img alt="image6" src="_images/ECG_delineator_corrector.png" /></p>
<div class="code highlight-Matlab"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span> <span class="n">bUseDesktop</span> <span class="p">)</span>
    <span class="c">% other task can be performed on the same objects</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="c">% last worker is the responsible of the visual correction.</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="o">==</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cant_pids</span><span class="p">)</span>
            <span class="c">% if there are not any previous error.</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Processed</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Error</span> <span class="p">)</span>
                <span class="c">% this is to use previous saved results as starting point,</span>
                <span class="c">% if any available</span>
                <span class="n">cached_filenames</span> <span class="p">=</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">GetCahchedFileName</span><span class="p">(</span> <span class="p">{</span><span class="s">&#39;ECG_delineation_corrector&#39;</span> <span class="s">&#39;ECG_delineation&#39;</span><span class="p">}</span> <span class="p">);</span>
                <span class="c">% if no previous correction work, try the automatic</span>
                <span class="c">% detection task</span>
                <span class="c">% if any, do the correction</span>
                <span class="k">if</span><span class="p">(</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">cached_filenames</span><span class="p">)</span> <span class="p">)</span>
                    <span class="c">% this is to use previous saved results as starting point,</span>
                    <span class="c">% if any available</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span> <span class="p">=</span> <span class="s">&#39;ECG_delineation_corrector&#39;</span><span class="p">;</span>
                    <span class="c">% This task is supposed to be supervised, so only one pid is enough.</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="p">=</span> <span class="s">&#39;1/1&#39;</span><span class="p">;</span>
                    <span class="c">% user provided name to individualize each run</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">user_string</span> <span class="p">=</span> <span class="n">user_str</span><span class="p">;</span>
                    <span class="c">% to avoid loading cached results and exit, this flag</span>
                    <span class="c">% allows the re-editing of the current state of the</span>
                    <span class="c">% detections.</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cacheResults</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
                    <span class="c">% maybe in your application you should run this for</span>
                    <span class="c">% all files.</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">payload</span> <span class="p">=</span> <span class="n">load</span><span class="p">(</span><span class="n">cached_filenames</span><span class="p">{</span><span class="mi">1</span><span class="p">});</span>
                    <span class="c">% process the task</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Run</span><span class="p">;</span>
                    <span class="c">% restore the original pids configuration</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="p">=</span> <span class="n">pid_str</span><span class="p">;</span>
                    <span class="c">% As we changed for &quot;QRS correction&quot; task, we have to enable this</span>
                    <span class="c">% value again in order to avoid performing the following tasks every time.</span>
                    <span class="c">% If you want to recalculate any task, change it to false</span>
                    <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cacheResults</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
                <span class="k">end</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="c">% at the end, report problems if happened.</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ReportErrors</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="automatic-heartbeat-classification">
<span id="id11"></span><h2>Automatic Heartbeat classification<a class="headerlink" href="#automatic-heartbeat-classification" title="Permalink to this headline">¶</a></h2>
<p>The last task described in this example is the classification of
heartbeats according to the <a class="reference external" href="matlab:web('http://marketplace.aami.org/eseries/scriptcontent/docs/Preview%20Files/EC57_1212_preview.pdf','-browser')">EC-57 AAMI
recommendation</a>.
To achieve this task, the kit includes a <a class="reference external" href="../../../../../../jsD:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGtask_heartbeat_classifier')">Heartbeat classification
task</a>
that interfaces with the <a class="reference external" href="','-browser')">Argentino-Aragonés heartbeat classifier
(a2hbc)</a> project in order to classify heartbeats into
the following classes:</p>
<ul class="simple">
<li><strong>N</strong> normal</li>
<li><strong>S</strong> supraventricular</li>
<li><strong>V</strong> ventricular</li>
<li><strong>F</strong> fusion of normal and ventricular</li>
</ul>
<p>The <em>a2hbc</em> algorithm can opperate automatically or assisted by the
user, for more details check the <a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('a2hbc')">a2hbc
documentation</a>.</p>
<div class="code highlight-Matlab"><div class="highlight"><pre>    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="c">% this is to use previous cached results as starting point</span>
        <span class="n">cached_filenames</span> <span class="p">=</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">GetCahchedFileName</span><span class="p">({</span><span class="s">&#39;QRS_corrector&#39;</span> <span class="s">&#39;QRS_detection&#39;</span><span class="p">});</span>
        <span class="c">% if corrected QRS detections are not available, wavedet</span>
        <span class="c">% performs automatic QRS detection.</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">cached_filenames</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span> <span class="p">=</span> <span class="s">&#39;ECG_heartbeat_classifier&#39;</span><span class="p">;</span>
            <span class="c">% the heartbeat classifier uses the QRS detection performed</span>
            <span class="c">% before, if available the task will use the corrected</span>
            <span class="c">% detections.</span>
            <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">payload</span> <span class="p">=</span> <span class="n">load</span><span class="p">(</span><span class="n">cached_filenames</span><span class="p">{</span><span class="mi">1</span><span class="p">});</span>
            <span class="c">% modes of operation of the a2hbc algorithm</span>
            <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">mode</span> <span class="p">=</span> <span class="s">&#39;auto&#39;</span><span class="p">;</span>
<span class="c">%             ECG_all_wrappers(ii).ECGtaskHandle.mode = &#39;slightly-assisted&#39;;</span>
<span class="c">%             ECG_all_wrappers(ii).ECGtaskHandle.mode = &#39;assisted&#39;;</span>
            <span class="c">% user provided name to individualize each run</span>
            <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ECGtaskHandle</span><span class="p">.</span><span class="n">user_string</span> <span class="p">=</span> <span class="n">user_str</span><span class="p">;</span>
            <span class="c">% process the task</span>
            <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">Run</span><span class="p">;</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="c">% at the end, report problems if happened.</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">ReportErrors</span><span class="p">;</span>
    <span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="visual-inspection-of-the-signal">
<span id="id12"></span><h2>Visual inspection of the signal<a class="headerlink" href="#visual-inspection-of-the-signal" title="Permalink to this headline">¶</a></h2>
<p>Finaly a report is generated with the results of the previous tasks,
either in a pdf document or several images. The report generated can be
customized with the interface described in the
<a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('reportECG')">documentation</a>.
The following are just three examples of a longer report:</p>
<p><img alt="image7" src="_images/ex_ABP_PPG_Registro_01M_full_Pagina_01.png" /></p>
<p>A snapshot of the center</p>
<p><img alt="image8" src="_images/ex_ABP_PPG_Registro_01M_full_Pagina_05.png" /></p>
<p>And finaly a snapshot of the last part of the recording.</p>
<p><img alt="image9" src="_images/ex_ABP_PPG_Registro_01M_full_Pagina_10.png" /></p>
<p>This is the code used to create a PDF report.</p>
<div class="code highlight-Matlab"><div class="highlight"><pre>    <span class="n">filename</span> <span class="p">=</span> <span class="p">[];</span> <span class="c">% default setting. Let the report function decide.</span>
<span class="c">%     filename = &#39;container_filename&#39;; % to put everything in one big file.</span>
    <span class="c">% other winlengths can be added to the array in order to further</span>
    <span class="c">% explore the recordings, and the algorithm results.</span>
<span class="c">%     winlengths = []; % default setting</span>
    <span class="n">winlengths</span> <span class="p">=</span> <span class="p">[</span> <span class="mi">7</span> <span class="p">];</span> <span class="c">%seconds</span>
    <span class="c">% go through all files</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">lrecnames</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="o">==</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cant_pids</span><span class="p">)</span>
            <span class="c">% last worker is the responsible of the reporting.</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">this_pid</span> <span class="o">==</span> <span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">cant_pids</span><span class="p">)</span>
                <span class="k">try</span>
                    <span class="n">reportECG</span><span class="p">(</span><span class="n">ECG_all_wrappers</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span> <span class="s">&#39;LowDetail&#39;</span><span class="p">,</span> <span class="s">&#39;full&#39;</span><span class="p">,</span> <span class="n">winlengths</span><span class="p">,</span> <span class="s">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="p">);</span>
                <span class="k">catch</span> <span class="n">MException</span>
                    <span class="n">report</span> <span class="p">=</span> <span class="n">getReport</span><span class="p">(</span><span class="n">MException</span><span class="p">);</span>
                    <span class="n">fprintf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;\n%s\n&#39;</span><span class="p">,</span> <span class="n">report</span><span class="p">);</span>
                <span class="k">end</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="other-user-defined-tasks">
<span id="id13"></span><h2>Other user-defined tasks ...<a class="headerlink" href="#other-user-defined-tasks" title="Permalink to this headline">¶</a></h2>
<p>Maybe the most important and useful aspect of the kit, is that you can
add your own algorithms. This can be done by following the interface
documented through the several examples included above. The <a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGtask_QRS_detection')">QRS
detection</a>
and <a class="reference external" href="../../../../../../:D:/Mariano/misc/ECGkit/help/robohelp/ECGkit/matlab:doc('ECGtask_ECG_delineation')">ECG
delineation</a>
tasks already include a way to interface your own algorithms through the
<strong>user:function_name</strong> method. Check the above sections for more
details.</p>
<div class="code highlight-Matlab"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span> <span class="o">~</span><span class="n">bUseDesktop</span> <span class="p">)</span>
    <span class="n">UnInstallECGkit</span><span class="p">();</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ECGwrapper.html" class="btn btn-neutral float-right" title="ECGwrapper">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="" class="btn btn-neutral" title="Examples"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Mariano Llamedo Soria.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>